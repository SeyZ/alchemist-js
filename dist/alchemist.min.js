!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Alchemist=e():t.Alchemist=e()}(this,function(){return function(t){function e(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t){var e=function(t){t=t||{},this.spaces={},this.abstract_spaces={},this.white=t.white,this.precision=t.precision||4};e.create=function(t){return new e(t)},e.prototype.Alchemist=e,e.prototype.use=function(t){if(s(t))for(var e=0;e<t.length;e++)this.use(t[e]);else if(t.to||t.from)this.defineColorSpace(t),this.makeColorMethod(t.name);else{if(!t.modifies)throw new Error("unrecognized plugin format");this.defineTransform(t)}},Color=function(t,e,o){o=o||{},this.color_space=t,this.value=e,this.white=o.white||{X:.95047,Y:1,Z:1.08883}},e.Color=e.prototype.Color=Color,e.prototype.removeAll=function(){this.spaces={},this.abstract_spaces={}},e.prototype.makeColorMethod=function(t){this[t]=function(e){if(arguments.length>1)var e=Array.prototype.slice(arguments);var o=new this.Color(t,e,{white:this.white});for(var r in this.spaces)this.makeConversionMethod(o,r);return o}},e.prototype.makeConversionMethod=function(t,e){var o=this;t[e]=function(){return o.round(o.convert(t,e).value)}},e.prototype.convert=function(t,e){var o,r,n,a,c=this.findColorSpace(t.color_space),f=this.findColorSpace(e);if(!c)throw new Error("Internal Error: could not find the "+current+" color space");if(!f)throw new Error("Internal Error: could not find the "+e+" color space");if(o=c.to[e],"function"==typeof o)return r=s(t.value)?o.apply(this,i(t.value).concat(t)):o(i(t.value),t),r=this.round(r),t.color_space=e,t.value=r,t;if("string"==typeof o)return n=this.convert(t,o),this.convert(n,e);if(a=this.mapConversionPath(t.color_space,e))return this.convert(t,e);throw new Error("Alchemist does not know how to convert from "+t.color_space+" to "+e)},e.prototype.round=function(t){if(s(t))for(var e=0;e<t.length;e++)t[e]=this.roundIfNumber(t[e]);else t=this.roundIfNumber(t);return t},e.prototype.roundIfNumber=function(t){return"number"==typeof t&&(t=Number(t.toFixed(this.precision))),t};var o={};o.spaces={},o.abstract_spaces={},o.findConversionPath=function(t,e){var o=[],r=[],n={};for(o.push(t),r.push(t);o.length;){var i=o.pop();if(i===e)return n;for(var s=this.findNeighbors(i),a=0;a<s.length;a++){var c=s[a];-1===r.indexOf(c)&&(n[c]=i,r.push(c),o.push(c))}}return null},o.findNeighbors=function(t){var e=[],o=this.spaces[t].to;for(conv_space in o)"function"==typeof o[conv_space]&&e.push(conv_space);return e},o.mapConversionPath=function(t,e){var o=this.findConversionPath(t,e);if(!o)return null;for(var r=o[e],n=o[r];;){if(this.spaces[n].to[e]&&"function"==typeof this.spaces[n].to[e]||(this.spaces[n].to[e]=r),n===t)return r;if(!o[n])return null;r=n,n=o[n]}},o.defineColorSpace=function(t){var e=t.name;this.validateName(e),this.isAbstractSpace(e)?this.makeConcrete(e):this.createSpace(e);for(var o in t.to){var r=t.to[o];this.isColorSpace(o)?this.defineConversion(e,o,r):this.defineAbstractConversion(o,e,"from",r)}for(var o in t.from){var r=t.from[o];this.isColorSpace(o)?this.defineConversion(o,e,r):this.defineAbstractConversion(o,e,"to",r)}},o.defineConversion=function(t,e,o){this.spaces[t].to[e]=o},o.defineAbstractConversion=function(t,e,o,r){var n=this.abstract_spaces;n[t]||this.createAbstractSpace(t),n[t][o][e]=r},o.validateName=function(t){if(this[t])throw this.spaces[t]?new Error('"'+t+'" Already Exists: there is a space with the same name already in use'):new Error("Invalid Name:",t,"is already the name of one of alchemist's private functions and can not be used as a the name of an color space")},o.createSpace=function(t){this.spaces[t]={to:{}}},o.isColorSpace=function(t){return Boolean(this.spaces[t])},o.createAbstractSpace=function(t){this.abstract_spaces[t]={to:{},from:{}}},o.isAbstractSpace=function(t){return Boolean(this.abstract_spaces[t])},o.makeConcrete=function(t){var e=this.abstract_spaces[t];delete this.abstract_spaces[t],e.name=t,this.defineColorSpace(e)},o.findColorSpace=function(t){return this.spaces[t]||null};var r={};r.defineModifier=function(){throw new Error("Modifiers are not yet implemented")};var n=function(t,e){if(arguments[2])for(var o=2,r=arguments.length;r>o;o++)t[arguments[o]]=e[arguments[o]];else for(var n in e)Object.hasOwnProperty.call(t,n)||(t[n]=e[n]);return t},i=function(t){var e=t.constructor;if(t instanceof String||t instanceof Number)return new e(t);if(s(t)){for(var o=[],r=0;r<t.length;r++)o[r]=t[r];return o}if("object"==typeof t)return n({},t);throw new Error("Alchemist does not know how to clone "+t)},s=function(t){return Array.isArray(t)};n(e.prototype,o),n(e.prototype,r),t.exports=e}])});